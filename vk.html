<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    :root {
      --primary: #8a2be2;
      --primary-dark: #4d00ff;
      --primary-light: #9d4edd;
      --accent: #ff006e;
      --accent-glow: rgba(255, 0, 110, 0.7);
      --neon-blue: #00f5ff;
      --neon-purple: #bc00ff;
      --dark-bg: #0a0a1a;
      --darker-bg: #050510;
      --card-bg: rgba(20, 10, 40, 0.85);
      --card-border: rgba(138, 43, 226, 0.3);
      --text-primary: #ffffff;
      --text-secondary: #e0e0e0;
      --text-glow: rgba(255, 255, 255, 0.8);
      --site-green: #00ff88;
      --site-green-glow: rgba(0, 255, 136, 0.3);
    }
    
    body {
      font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: var(--text-primary);
      min-height: 100vh;
      background: 
        radial-gradient(circle at 20% 80%, rgba(77, 0, 255, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 0, 110, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(0, 245, 255, 0.1) 0%, transparent 50%),
        linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 50%, var(--darker-bg) 100%);
      display: flex;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        linear-gradient(90deg, transparent 98%, rgba(138, 43, 226, 0.03) 100%),
        linear-gradient(0deg, transparent 98%, rgba(138, 43, 226, 0.03) 100%);
      background-size: 30px 30px;
      pointer-events: none;
      z-index: 1;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —á–∞—Å—Ç–∏—Ü */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
    
    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--primary);
      border-radius: 50%;
      box-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary);
      animation: float 15s infinite linear;
    }
    
    @keyframes float {
      0% {
        transform: translateY(100vh) translateX(0);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100px) translateX(100px);
        opacity: 0;
      }
    }
    
    /* –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å */
    nav {
      background: rgba(10, 5, 25, 0.95);
      padding: 18px 20px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      gap: 35px;
      flex-wrap: wrap;
      z-index: 10;
      position: relative;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(138, 43, 226, 0.2);
    }
    
    nav a {
      color: var(--text-primary);
      text-decoration: none;
      font-weight: bold;
      font-size: 1.1rem;
      padding: 12px 24px;
      border-radius: 25px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      background: rgba(138, 43, 226, 0.1);
      border: 1px solid transparent;
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'Montserrat', sans-serif;
    }
    
    nav a::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      opacity: 0;
      transition: opacity 0.3s;
      z-index: -1;
      border-radius: 25px;
    }
    
    nav a:hover {
      color: white;
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(77, 0, 255, 0.4);
      border: 1px solid rgba(138, 43, 226, 0.5);
    }
    
    nav a:hover::before {
      opacity: 1;
    }
    
    nav a i {
      font-size: 1.2rem;
    }
    
    header {
      background: rgba(10, 5, 25, 0.95);
      padding: 25px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.8);
      text-align: center;
      color: transparent;
      background-clip: text;
      -webkit-background-clip: text;
      background-image: linear-gradient(135deg, var(--primary) 0%, var(--neon-blue) 50%, var(--accent) 100%);
      font-size: 2.5rem;
      font-weight: 900;
      font-family: 'Orbitron', sans-serif;
      text-shadow: 0 0 20px rgba(138, 43, 226, 0.7);
      border-bottom: 1px solid rgba(138, 43, 226, 0.3);
      backdrop-filter: blur(10px);
      position: relative;
      z-index: 10;
    }
    
    .container {
      display: flex;
      flex: 1;
      gap: 30px;
      padding: 30px;
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
      position: relative;
      z-index: 2;
    }
    
    .panel {
      flex: 1;
      background: var(--card-bg);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.5),
        inset 0 0 30px rgba(77, 0, 255, 0.1);
      display: flex;
      flex-direction: column;
      border: 1px solid var(--card-border);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    
    .panel:hover {
      box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.6),
        inset 0 0 40px rgba(77, 0, 255, 0.15);
      transform: translateY(-5px);
    }
    
    .panel h2 {
      color: transparent;
      background-clip: text;
      -webkit-background-clip: text;
      background-image: linear-gradient(135deg, var(--primary) 0%, var(--neon-blue) 100%);
      margin-bottom: 25px;
      font-size: 2rem;
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      text-align: center;
      border-bottom: 2px solid var(--primary);
      padding-bottom: 15px;
      text-shadow: 0 0 15px rgba(77, 0, 255, 0.5);
    }
    
    .post-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    label {
      color: var(--primary);
      font-weight: bold;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    input, textarea, select {
      padding: 14px 18px;
      border-radius: 12px;
      border: 1px solid rgba(138, 43, 226, 0.4);
      background: rgba(255, 255, 255, 0.08);
      color: var(--text-primary);
      font-size: 1rem;
      transition: all 0.3s ease;
      font-family: 'Montserrat', sans-serif;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 15px rgba(77, 0, 255, 0.5);
      background: rgba(255, 255, 255, 0.12);
    }
    
    textarea {
      min-height: 150px;
      resize: vertical;
    }
    
    .platform-info {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 20px;
      background: rgba(138, 43, 226, 0.1);
      border-radius: 15px;
      border: 1px solid var(--primary);
      transition: all 0.3s ease;
    }
    
    .platform-info:hover {
      background: rgba(138, 43, 226, 0.15);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(77, 0, 255, 0.3);
    }
    
    .platform-icon {
      font-size: 3.5rem;
      color: var(--primary);
      filter: drop-shadow(0 0 10px var(--primary));
    }
    
    .platform-details {
      flex: 1;
    }
    
    .platform-name {
      font-size: 1.6rem;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 8px;
      font-family: 'Orbitron', sans-serif;
    }
    
    .platform-status {
      color: #4caf50;
      font-size: 1rem;
      font-weight: bold;
    }
    
    .url-input-group {
      display: flex;
      gap: 12px;
    }
    
    .url-input-group input {
      flex: 1;
    }
    
    .preview-container {
      margin-top: 20px;
      text-align: center;
    }
    
    .preview-image {
      max-width: 100%;
      max-height: 220px;
      border-radius: 12px;
      display: none;
      border: 2px solid var(--primary);
      margin: 0 auto;
      box-shadow: 0 5px 15px rgba(77, 0, 255, 0.3);
    }
    
    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    button {
      flex: 1;
      padding: 16px 20px;
      border: none;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
      min-width: 220px;
      font-family: 'Montserrat', sans-serif;
    }
    
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 50%, var(--accent) 100%);
      color: var(--text-primary);
      box-shadow: 0 8px 20px rgba(77, 0, 255, 0.4);
    }
    
    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    
    .btn-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--accent) 100%);
      transform: translateY(-5px);
      box-shadow: 0 12px 25px rgba(77, 0, 255, 0.6);
    }
    
    .btn-primary:hover:not(:disabled)::before {
      left: 100%;
    }
    
    .btn-primary:active:not(:disabled) {
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: rgba(138, 43, 226, 0.2);
      color: var(--text-primary);
      border: 2px solid var(--primary);
      box-shadow: 0 8px 20px rgba(77, 0, 255, 0.2);
    }
    
    .btn-secondary:hover:not(:disabled) {
      background: rgba(138, 43, 226, 0.3);
      transform: translateY(-5px);
      box-shadow: 0 12px 25px rgba(77, 0, 255, 0.4);
    }
    
    .btn-secondary:active:not(:disabled) {
      transform: translateY(-2px);
    }
    
    /* –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è —Å–∞–π—Ç–∞ */
    .btn-site {
      background: linear-gradient(135deg, #00b894 0%, #00ff88 50%, #00ffaa 100%);
      color: var(--text-primary);
      box-shadow: 0 8px 20px rgba(0, 255, 136, 0.4);
    }
    
    .btn-site::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }
    
    .btn-site:hover:not(:disabled) {
      background: linear-gradient(135deg, #00ff88 0%, #00ffaa 100%);
      transform: translateY(-5px);
      box-shadow: 0 12px 25px rgba(0, 255, 136, 0.6);
    }
    
    .btn-site:hover:not(:disabled)::before {
      left: 100%;
    }
    
    .btn-site:active:not(:disabled) {
      transform: translateY(-2px);
    }
    
    .status-message {
      padding: 16px;
      border-radius: 12px;
      margin: 15px 0;
      text-align: center;
      font-weight: bold;
      display: none;
      animation: fadeIn 0.3s ease;
      font-size: 1.1rem;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .success {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
      border: 1px solid #4caf50;
      box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
    }
    
    .error {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
      border: 1px solid #f44336;
      box-shadow: 0 5px 15px rgba(244, 67, 54, 0.3);
    }
    
    .site-message {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border: 1px solid #00ff88;
      box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
    }
    
    .button-loading {
      position: relative;
      color: transparent !important;
    }
    
    .button-loading::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      border: 2px solid transparent;
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .schedule-options {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .schedule-toggle {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 65px;
      height: 36px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(26, 15, 56, 0.8);
      border: 2px solid var(--primary);
      transition: .4s;
      border-radius: 36px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 28px;
      width: 28px;
      left: 2px;
      bottom: 2px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      transition: .4s;
      border-radius: 50%;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }
    
    input:checked + .toggle-slider {
      background-color: rgba(138, 43, 226, 0.2);
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(29px);
    }
    
    .datetime-input {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .datetime-input.active {
      display: flex;
    }
    
    .history-item {
      background: rgba(138, 43, 226, 0.1);
      border-radius: 12px;
      padding: 18px;
      margin-bottom: 12px;
      border: 1px solid var(--primary);
      transition: all 0.3s ease;
    }
    
    .history-item:hover {
      background: rgba(138, 43, 226, 0.15);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(77, 0, 255, 0.2);
    }
    
    .history-text {
      margin-bottom: 12px;
      line-height: 1.5;
      color: var(--text-primary);
    }
    
    .history-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    .history-status {
      color: #4caf50;
      font-weight: bold;
    }
    
    .api-status {
      margin-top: 12px;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      font-size: 1rem;
      font-weight: bold;
    }
    
    .api-status.connected {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
      border: 1px solid #4caf50;
      box-shadow: 0 3px 10px rgba(76, 175, 80, 0.2);
    }
    
    .api-status.error {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
      border: 1px solid #f44336;
      box-shadow: 0 3px 10px rgba(244, 67, 54, 0.2);
    }
    
    .test-buttons {
      display: flex;
      gap: 12px;
      margin-top: 15px;
    }
    
    .test-btn {
      padding: 10px 18px;
      background: rgba(138, 43, 226, 0.2);
      border: 1px solid var(--primary);
      color: var(--text-primary);
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      font-family: 'Montserrat', sans-serif;
      font-weight: bold;
    }
    
    .test-btn:hover {
      background: rgba(138, 43, 226, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(77, 0, 255, 0.3);
    }
    
    .debug-info {
      background: rgba(138, 43, 226, 0.1);
      padding: 15px;
      border-radius: 12px;
      margin-top: 15px;
      font-size: 0.9rem;
      color: var(--text-secondary);
      border: 1px solid var(--primary);
    }
    
    .local-history {
      max-height: 450px;
      overflow-y: auto;
    }
    
    .photo-attachment {
      background: rgba(138, 43, 226, 0.1);
      padding: 20px;
      border-radius: 15px;
      margin-top: 15px;
      border: 1px solid var(--primary);
    }
    
    .photo-inputs {
      display: flex;
      gap: 12px;
      margin-top: 15px;
    }
    
    .char-counter {
      text-align: right;
      margin-top: 8px;
      color: var(--text-secondary);
      font-size: 1rem;
    }
    
    .photo-preview {
      margin-top: 15px;
      text-align: center;
    }
    
    .extracted-info {
      background: rgba(76, 175, 80, 0.1);
      padding: 15px;
      border-radius: 12px;
      margin-top: 15px;
      border: 1px solid #4caf50;
      font-size: 1rem;
      color: #4caf50;
      font-weight: bold;
      display: none;
    }
    
    .form-control {
      padding: 14px 18px;
      border-radius: 12px;
      border: 1px solid rgba(138, 43, 226, 0.4);
      background: rgba(255, 255, 255, 0.08);
      color: var(--text-primary);
      font-size: 1rem;
      transition: all 0.3s ease;
      font-family: 'Montserrat', sans-serif;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 15px rgba(77, 0, 255, 0.5);
      background: rgba(255, 255, 255, 0.12);
    }

    /* –í–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ */
    .watermark {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 300px;
      height: 300px;
      transform: translate(-50%, -50%);
      opacity: 0.03;
      pointer-events: none;
      user-select: none;
      z-index: 1;
      background: url('https://img.icons8.com/?size=100&id=gmWPXKWPTf64&format=png&color=000000') no-repeat center center;
      background-size: contain;
      animation: watermarkPulse 8s ease-in-out infinite alternate;
      filter: brightness(2);
    }
    
    @keyframes watermarkPulse {
      0% {
        opacity: 0.02;
        transform: translate(-50%, -50%) scale(1) rotate(0deg);
      }
      50% {
        opacity: 0.05;
        transform: translate(-50%, -50%) scale(1.05) rotate(2deg);
      }
      100% {
        opacity: 0.02;
        transform: translate(-50%, -50%) scale(1) rotate(0deg);
      }
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
    @media (max-width: 768px) {
      nav {
        flex-direction: column;
        gap: 12px;
        padding: 15px;
      }
      
      nav a {
        justify-content: center;
        padding: 10px 20px;
      }
      
      .container {
        flex-direction: column;
        padding: 20px;
        gap: 20px;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      button {
        min-width: auto;
      }
      
      header {
        font-size: 2rem;
        padding: 20px;
      }
      
      .platform-info {
        flex-direction: column;
        text-align: center;
        gap: 15px;
      }
      
      .photo-inputs {
        flex-direction: column;
      }
      
      .test-buttons {
        flex-direction: column;
      }
    }
    
    @media (max-width: 480px) {
      nav {
        gap: 8px;
      }
      
      nav a {
        font-size: 1rem;
        padding: 8px 16px;
      }
      
      header {
        font-size: 1.8rem;
      }
      
      .panel {
        padding: 20px;
      }
      
      .panel h2 {
        font-size: 1.6rem;
      }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ */
    .site-status-message {
      padding: 16px;
      border-radius: 12px;
      margin: 15px 0;
      text-align: center;
      font-weight: bold;
      display: none;
      animation: fadeIn 0.3s ease;
      font-size: 1.1rem;
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border: 1px solid #00ff88;
      box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
    }
  </style>
</head>
<body>
  <!-- –ß–∞—Å—Ç–∏—Ü—ã —Ñ–æ–Ω–∞ -->
  <div class="particles" id="particles"></div>
  
  <!-- –í–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ -->
  <div class="watermark" aria-hidden="true"></div>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
  <nav>
    <a href="index.html"><i class="fas fa-cube"></i> –ú–æ–∏ –ø—Ä–µ–¥–º–µ—Ç—ã</a>
    <a href="index.html"><i class="fas fa-exchange-alt"></i> –ü—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è –æ–±–º–µ–Ω–∞</a>
    <a href="index.html"><i class="fas fa-address-book"></i> –ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
    <a href="vk.html"><i class="fab fa-vk"></i> –ü–æ—Å—Ç—ã –≤ –í–ö</a>
    
  </nav>

  <header>
    <i class="fas fa-share-alt"></i> –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
  </header>
  
  <div class="container">
    <div class="panel">
      <h2>–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞</h2>
      <form class="post-form" id="postForm">
        <div class="form-group">
          <div class="platform-info">
            <i class="fab fa-vk platform-icon"></i>
            <div class="platform-details">
              <div class="platform-name">–í–ö–æ–Ω—Ç–∞–∫—Ç–µ</div>
              <div class="platform-status">‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –≥—Ä—É–ø–ø–µ ID: 233256913</div>
              <div id="apiStatus" class="api-status">
                <i class="fas fa-sync fa-spin"></i> –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...
              </div>
              <div class="test-buttons">
                <button type="button" class="test-btn" onclick="testConnection()">–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
                <button type="button" class="test-btn" onclick="testPostPublishing()">–¢–µ—Å—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="postText"><i class="fas fa-edit"></i> –¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞</label>
          <textarea id="postText" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ..." maxlength="4000"></textarea>
          <div class="char-counter">
            <span id="charCount">0</span>/4000 —Å–∏–º–≤–æ–ª–æ–≤
          </div>
        </div>

        <div class="form-group">
          <label><i class="fas fa-image"></i> –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ –∏–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ</label>
          <div class="photo-attachment">
            <p><strong>–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–æ—Ç–æ –∏–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ:</strong></p>
            <div class="photo-inputs">
              <input type="url" id="photoUrl" placeholder="https://vk.com/photo123456789_456239021" class="form-control">
              <button type="button" class="btn-secondary" id="parseUrlBtn">
                <i class="fas fa-link"></i> –ò–∑–≤–ª–µ—á—å ID
              </button>
            </div>
            <div id="extractedInfo" class="extracted-info" style="display: none;">
              <i class="fas fa-check-circle"></i> ID –∏–∑–≤–ª–µ—á–µ–Ω—ã: <span id="photoIds"></span>
            </div>
            <div class="photo-preview">
              <img id="previewImage" class="preview-image" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
            </div>
            <small style="color: var(--text-secondary); margin-top: 8px; display: block;">
              –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–æ—Ç–æ –∏–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
            </small>
          </div>
        </div>

        <div class="form-group">
          <label><i class="fas fa-clock"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
          <div class="schedule-options">
            <div class="schedule-toggle">
              <label class="toggle-switch">
                <input type="checkbox" id="scheduleToggle">
                <span class="toggle-slider"></span>
              </label>
              <span>–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è</span>
            </div>
            
            <div class="datetime-input" id="datetimeInput">
              <input type="datetime-local" id="scheduleDateTime">
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="schedule-toggle">
            <label class="toggle-switch">
              <input type="checkbox" id="fromGroup" checked>
              <span class="toggle-slider"></span>
            </label>
            <span>–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ—Ç –∏–º–µ–Ω–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</span>
          </div>
          <div class="schedule-toggle">
            <label class="toggle-switch">
              <input type="checkbox" id="signed" checked>
              <span class="toggle-slider"></span>
            </label>
            <span>–ü–æ–¥–ø–∏—Å–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)</span>
          </div>
        </div>
        
        <!-- –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê –î–õ–Ø –°–ê–ô–¢–ê -->
        <div class="button-group">
          <button type="button" class="btn-primary" id="publishBtn">
            <i class="fas fa-paper-plane"></i> –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ –í–ö
          </button>
          
          <button type="button" class="btn-secondary" id="previewBtn">
            <i class="fas fa-eye"></i> –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
          </button>
        </div>
        
        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–µ -->
        <div class="site-status-message" id="siteMessage">
          <i class="fas fa-check-circle"></i> –ü–æ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ!
        </div>
        
        <div class="status-message success" id="successMessage">
          <i class="fas fa-check-circle"></i> –ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ!
        </div>
        
        <div class="status-message error" id="errorMessage">
          <i class="fas fa-exclamation-triangle"></i> –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
        </div>

        <div class="debug-info" id="debugInfo">
          –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—Ä–æ—Å–∞—Ö –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å
        </div>
      </form>
    </div>
    
    <div class="panel">
      <h2>–ò—Å—Ç–æ—Ä–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–π</h2>
      <div class="form-group">
        <input type="text" id="searchHistory" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏..." class="form-control">
      </div>
      <div class="local-history">
        <div id="historyList">
          <div class="history-item">
            <div class="history-text">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö –ø–æ—Å—Ç–æ–≤</div>
            <div class="history-meta">
              <span>--.--.---- --:--</span>
              <span class="history-status">–ì–æ—Ç–æ–≤</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Å—Ç–∏—Ü
    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      const particleCount = 25;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // –°–ª—É—á–∞–π–Ω—ã–µ –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
        const left = Math.random() * 100;
        const size = Math.random() * 3 + 1;
        const opacity = Math.random() * 0.5 + 0.2;
        const animationDuration = Math.random() * 20 + 10;
        const animationDelay = Math.random() * 5;
        
        particle.style.left = `${left}%`;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.opacity = opacity;
        particle.style.animationDuration = `${animationDuration}s`;
        particle.style.animationDelay = `${animationDelay}s`;
        
        particlesContainer.appendChild(particle);
      }
    }

    const VK_TOKEN = 'vk1.a.7uJ7G6fmHIYr8WGbLxDwJihIVjf1cF6HAIJ0WiCB9BpphP57D09rQhsu2lpOWT8dDjOuQldkbye8UyhtBK764iHAbrMy5zipVhBmrlJW-q45e1htB4sxiAtMWa9QpssoffYG8k6YolcvLogAMIykahh5IHc7pBvf7KJSr12EO_rM1TWiHWdm9WGk7bYKK3cAQEzzIKcVY86iD2MIqKRIRQ';
    const GROUP_ID = '-233612410';
    let localHistory = JSON.parse(localStorage.getItem('vk_publish_history') || '[]');
    let extractedPhotoIds = [];

    // –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ø–æ—Å—Ç–æ–≤ –Ω–∞ —Å–∞–π—Ç–µ
    let sitePosts = JSON.parse(localStorage.getItem('site_posts') || '[]');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
      createParticles();
      initializeScheduleToggle();
      checkTokenValidity();
      loadLocalHistory();
      setupCharCounter();
      setupUrlParser();
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å–∞–π—Ç–∞
      document.getElementById('publishSiteBtn').addEventListener('click', publishToSite);
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
      const savedDraft = localStorage.getItem('vk_draft');
      if (savedDraft) {
        document.getElementById('postText').value = savedDraft;
        document.getElementById('charCount').textContent = savedDraft.length;
      }
    });

    // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ —Å–∞–π—Ç–µ
    function publishToSite() {
      const postText = document.getElementById('postText').value.trim();
      const publishBtn = document.getElementById('publishSiteBtn');
      const siteMessage = document.getElementById('siteMessage');
      
      if (!postText) {
        showMessage('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–µ', 'error');
        return;
      }
      
      publishBtn.classList.add('button-loading');
      publishBtn.disabled = true;
      
      try {
        // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –ø–æ—Å—Ç–∞ –¥–ª—è —Å–∞–π—Ç–∞
        const sitePost = {
          id: Date.now(),
          text: postText,
          photos: extractedPhotoIds.length > 0 ? extractedPhotoIds.map(id => `photo${id}`) : [],
          timestamp: new Date().toISOString(),
          date: new Date().toLocaleString('ru-RU'),
          fromGroup: document.getElementById('fromGroup').checked,
          signed: document.getElementById('signed').checked,
          type: 'site_post'
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –ø—Ä–µ–≤—å—é –µ—Å–ª–∏ –µ—Å—Ç—å
        if (extractedPhotoIds.length > 0) {
          const previewImage = document.getElementById('previewImage');
          if (previewImage.src) {
            sitePost.photoPreview = previewImage.src;
          }
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        sitePosts.unshift(sitePost);
        localStorage.setItem('site_posts', JSON.stringify(sitePosts));
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
        siteMessage.innerHTML = `<i class="fas fa-check-circle"></i> –ü–æ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ! ID: ${sitePost.id}`;
        siteMessage.style.display = 'block';
        
        // –°–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        document.getElementById('successMessage').style.display = 'none';
        document.getElementById('errorMessage').style.display = 'none';
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        addToLocalHistory(postText, `site_${sitePost.id}`, true, 'site');
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
          siteMessage.style.display = 'none';
        }, 5000);
        
        updateDebugInfo(`–ü–æ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ —Å ID: ${sitePost.id}`);
        
      } catch (error) {
        showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ: ' + error.message, 'error');
        updateDebugInfo('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–µ: ' + error.message);
      } finally {
        publishBtn.classList.remove('button-loading');
        publishBtn.disabled = false;
      }
    }

    // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤
    function setupCharCounter() {
      const postText = document.getElementById('postText');
      const charCount = document.getElementById('charCount');
      
      postText.addEventListener('input', function() {
        charCount.textContent = this.value.length;
      });
    }

    // –ü–∞—Ä—Å–µ—Ä —Å—Å—ã–ª–æ–∫ –í–ö
    function setupUrlParser() {
      const parseBtn = document.getElementById('parseUrlBtn');
      const photoUrl = document.getElementById('photoUrl');
      
      parseBtn.addEventListener('click', function() {
        const url = photoUrl.value.trim();
        if (!url) {
          showMessage('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–æ—Ç–æ', 'error');
          return;
        }
        
        const photoIds = extractPhotoIdsFromUrl(url);
        if (photoIds.length > 0) {
          extractedPhotoIds = photoIds;
          displayExtractedIds(photoIds);
          showMessage(`–£—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–æ ${photoIds.length} ID —Ñ–æ—Ç–æ`, 'success');
          loadPhotoPreview(photoIds[0]);
        } else {
          showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å ID —Ñ–æ—Ç–æ –∏–∑ —Å—Å—ã–ª–∫–∏', 'error');
        }
      });
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ
      photoUrl.addEventListener('paste', function(e) {
        setTimeout(() => {
          const url = photoUrl.value.trim();
          const photoIds = extractPhotoIdsFromUrl(url);
          if (photoIds.length > 0) {
            extractedPhotoIds = photoIds;
            displayExtractedIds(photoIds);
            loadPhotoPreview(photoIds[0]);
          }
        }, 100);
      });
    }

    // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ ID —Ñ–æ—Ç–æ –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å—Å—ã–ª–æ–∫ –í–ö
    function extractPhotoIdsFromUrl(url) {
      const patterns = [
        // photo123456789_456239021
        /photo(-?\d+)_(\d+)/,
        // https://vk.com/photo123456789_456239021
        /vk\.com\/photo(-?\d+)_(\d+)/,
        // https://vk.com/wall123456789?z=photo123456789_456239021
        /z=photo(-?\d+)_(\d+)/,
        // albums123456789/456239021
        /albums(-?\d+)\/(\d+)/,
        // photos123456789/456239021
        /photos(-?\d+)\/(\d+)/
      ];
      
      const photoIds = [];
      
      for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match) {
          const ownerId = match[1];
          const photoId = match[2];
          photoIds.push(`${ownerId}_${photoId}`);
        }
      }
      
      return photoIds;
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö ID
    function displayExtractedIds(photoIds) {
      const extractedInfo = document.getElementById('extractedInfo');
      const photoIdsSpan = document.getElementById('photoIds');
      
      photoIdsSpan.textContent = photoIds.map(id => `photo${id}`).join(', ');
      extractedInfo.style.display = 'block';
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–≤—å—é —Ñ–æ—Ç–æ
    function loadPhotoPreview(photoId) {
      const previewImage = document.getElementById('previewImage');
      
      // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã URL –¥–ª—è –ø—Ä–µ–≤—å—é
      const previewUrls = [
        `https://sun9-71.userapi.com/impg/${photoId.replace('_', '/')}.jpg`,
        `https://sun1-87.userapi.com/impg/${photoId.replace('_', '/')}.jpg`,
        `https://sun9-74.userapi.com/impg/${photoId.replace('_', '/')}.jpg`
      ];
      
      let currentUrlIndex = 0;
      
      function tryNextUrl() {
        if (currentUrlIndex >= previewUrls.length) {
          previewImage.style.display = 'none';
          return;
        }
        
        previewImage.src = previewUrls[currentUrlIndex];
        previewImage.style.display = 'block';
        
        previewImage.onload = function() {
          // –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
        };
        
        previewImage.onerror = function() {
          currentUrlIndex++;
          tryNextUrl();
        };
      }
      
      tryNextUrl();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
    function initializeScheduleToggle() {
      const scheduleToggle = document.getElementById('scheduleToggle');
      const datetimeInput = document.getElementById('datetimeInput');
      
      if (scheduleToggle && datetimeInput) {
        scheduleToggle.addEventListener('change', function() {
          if (this.checked) {
            datetimeInput.classList.add('active');
            const minDate = new Date(Date.now() + 5 * 60 * 1000);
            document.getElementById('scheduleDateTime').min = minDate.toISOString().slice(0, 16);
            const defaultDate = new Date(Date.now() + 60 * 60 * 1000);
            document.getElementById('scheduleDateTime').value = defaultDate.toISOString().slice(0, 16);
          } else {
            datetimeInput.classList.remove('active');
          }
        });
      }
    }

    // JSONP —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS
    function callVKAPI(method, params = {}) {
      return new Promise((resolve, reject) => {
        const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());
        const script = document.createElement('script');
        
        const baseParams = {
          access_token: VK_TOKEN,
          v: '5.199'
        };
        
        const allParams = { ...baseParams, ...params };
        allParams.callback = callbackName;
        
        const paramString = Object.keys(allParams)
          .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(allParams[key])}`)
          .join('&');
        
        const url = `https://api.vk.com/method/${method}?${paramString}`;
        
        updateDebugInfo(`–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${method}`);
        
        window[callbackName] = function(data) {
          delete window[callbackName];
          document.body.removeChild(script);
          
          if (data.error) {
            updateDebugInfo(`–û—à–∏–±–∫–∞ API: ${data.error.error_msg}`);
            reject(new Error(`VK API: ${data.error.error_msg} (–∫–æ–¥: ${data.error.error_code})`));
          } else {
            updateDebugInfo(`–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç: ${method}`);
            resolve(data.response);
          }
        };
        
        script.onerror = function() {
          delete window[callbackName];
          document.body.removeChild(script);
          updateDebugInfo('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞');
          reject(new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ VK API'));
        };
        
        script.src = url;
        document.body.appendChild(script);
      });
    }

    // –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    async function testConnection() {
      try {
        showMessage('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...', 'success');
        const result = await callVKAPI('wall.post', {
          owner_id: GROUP_ID,
          message: '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è',
          publish_date: Math.floor(Date.now() / 1000) + 300
        });
        showMessage('‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! –ú–æ–∂–Ω–æ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã', 'success');
      } catch (error) {
        if (error.message.includes('wall.post')) {
          showMessage('‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! –û—à–∏–±–∫–∞ –æ–∂–∏–¥–∞–µ–º–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞', 'success');
        } else {
          showMessage('‚úó –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
        }
      }
    }

    // –¢–µ—Å—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
    async function testPostPublishing() {
      try {
        showMessage('–¢–µ—Å—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–∏...', 'success');
        const result = await callVKAPI('wall.post', {
          owner_id: GROUP_ID,
          message: '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç –æ—Ç ' + new Date().toLocaleString('ru-RU'),
          from_group: 1,
          signed: 1
        });
        showMessage('‚úì –¢–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω! –ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω —Å ID: ' + result.post_id, 'success');
        addToLocalHistory('–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç', result.post_id, true, 'vk');
      } catch (error) {
        showMessage('‚úó –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ' + error.message, 'error');
      }
    }

    async function checkTokenValidity() {
      try {
        await callVKAPI('wall.post', {
          owner_id: GROUP_ID,
          message: 'test',
          publish_date: Math.floor(Date.now() / 1000) + 3600
        });
        
        document.getElementById('apiStatus').className = 'api-status connected';
        document.getElementById('apiStatus').innerHTML = 
          `<i class="fas fa-check-circle"></i> –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω, –º–æ–∂–Ω–æ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã`;
          
      } catch (error) {
        if (error.message.includes('wall.post')) {
          document.getElementById('apiStatus').className = 'api-status connected';
          document.getElementById('apiStatus').innerHTML = 
            `<i class="fas fa-check-circle"></i> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ (–æ—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –ø–æ—Å—Ç–µ –æ–∂–∏–¥–∞–µ–º–∞)`;
        } else {
          document.getElementById('apiStatus').className = 'api-status error';
          document.getElementById('apiStatus').innerHTML = 
            `<i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞: ${error.message}`;
        }
      }
    }

    // –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞ –≤ –í–ö
    document.getElementById('publishBtn').addEventListener('click', async function() {
      const postText = document.getElementById('postText').value.trim();
      const publishBtn = this;
      
      if (!postText) {
        showMessage('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞', 'error');
        return;
      }
      
      publishBtn.classList.add('button-loading');
      publishBtn.disabled = true;
      
      try {
        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
        const params = {
          owner_id: GROUP_ID,
          message: postText,
          from_group: document.getElementById('fromGroup').checked ? 1 : 0,
          signed: document.getElementById('signed').checked ? 1 : 0
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ ID
        if (extractedPhotoIds.length > 0) {
          const attachments = extractedPhotoIds.map(id => `photo${id}`).join(',');
          params.attachments = attachments;
          updateDebugInfo(`–ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º—ã–µ —Ñ–æ—Ç–æ: ${attachments}`);
        }
        
        // –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è
        const scheduleToggle = document.getElementById('scheduleToggle');
        if (scheduleToggle && scheduleToggle.checked) {
          const dateTimeInput = document.getElementById('scheduleDateTime');
          if (dateTimeInput && dateTimeInput.value) {
            const dateTime = new Date(dateTimeInput.value);
            if (dateTime > new Date()) {
              params.publish_date = Math.floor(dateTime.getTime() / 1000);
              updateDebugInfo(`–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è: ${dateTime.toLocaleString('ru-RU')}`);
            }
          }
        }
        
        updateDebugInfo(`–ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞: ${postText.substring(0, 50)}...`);
        
        // –ü—É–±–ª–∏–∫—É–µ–º –ø–æ—Å—Ç
        const result = await callVKAPI('wall.post', params);
        
        let successMsg = '‚úì –ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ! ID: ' + result.post_id;
        if (extractedPhotoIds.length > 0) {
          successMsg += ` —Å ${extractedPhotoIds.length} —Ñ–æ—Ç–æ`;
        }
        showMessage(successMsg, 'success');
        updateDebugInfo(`–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω —Å ID: ${result.post_id}`);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
        addToLocalHistory(postText, result.post_id, true, 'vk');
        
        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
        resetForm();
        
      } catch (error) {
        const errorMsg = '‚úó –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: ' + error.message;
        showMessage(errorMsg, 'error');
        updateDebugInfo(errorMsg);
        
        addToLocalHistory(postText, 'error', false, 'vk');
        
        console.error('Publish error:', error);
      } finally {
        publishBtn.classList.remove('button-loading');
        publishBtn.disabled = false;
      }
    });

    // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
    document.getElementById('previewBtn').addEventListener('click', function() {
      const postText = document.getElementById('postText').value.trim();
      if (!postText) {
        showMessage('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞', 'error');
        return;
      }
      
      localStorage.setItem('vk_draft', postText);
      
      let previewInfo = '–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –≥–æ—Ç–æ–≤ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏. ';
      if (extractedPhotoIds.length > 0) {
        previewInfo += `–ë—É–¥–µ—Ç –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ ${extractedPhotoIds.length} —Ñ–æ—Ç–æ`;
      } else {
        previewInfo += '–§–æ—Ç–æ –Ω–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω—ã.';
      }
      
      showMessage(previewInfo, 'success');
    });

    // –õ–æ–∫–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
    function addToLocalHistory(text, postId, success, type = 'vk') {
      const historyItem = {
        id: Date.now(),
        text: text,
        postId: postId,
        success: success,
        type: type, // 'vk' –∏–ª–∏ 'site'
        timestamp: new Date().toISOString(),
        date: new Date().toLocaleString('ru-RU')
      };
      
      localHistory.unshift(historyItem);
      localHistory = localHistory.slice(0, 50);
      localStorage.setItem('vk_publish_history', JSON.stringify(localHistory));
      
      loadLocalHistory();
    }

    function loadLocalHistory() {
      const historyList = document.getElementById('historyList');
      historyList.innerHTML = '';
      
      if (localHistory.length === 0) {
        historyList.innerHTML = `
          <div class="history-item">
            <div class="history-text">–ò—Å—Ç–æ—Ä–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–π –ø—É—Å—Ç–∞</div>
            <div class="history-meta">
              <span>--.--.---- --:--</span>
              <span class="history-status">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
            </div>
          </div>
        `;
        return;
      }
      
      localHistory.forEach(item => {
        const shortText = item.text.length > 100 ? item.text.substring(0, 100) + '...' : item.text;
        let status = '';
        let statusColor = '';
        
        if (item.type === 'site') {
          status = item.success ? 'üåê –ù–∞ —Å–∞–π—Ç–µ' : '‚ùå –û—à–∏–±–∫–∞ —Å–∞–π—Ç–∞';
          statusColor = item.success ? '#00ff88' : '#f44336';
        } else {
          status = item.success ? '‚úÖ –í–ö' : '‚ùå –û—à–∏–±–∫–∞ –í–ö';
          statusColor = item.success ? '#4caf50' : '#f44336';
        }
        
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
          <div class="history-text">${shortText}</div>
          <div class="history-meta">
            <span>${item.date}</span>
            <span class="history-status" style="color: ${statusColor};">${status}</span>
          </div>
          ${item.postId && item.postId !== 'error' ? 
            `<div style="font-size: 0.7rem; color: var(--text-secondary);">ID: ${item.postId}</div>` : ''}
        `;
        historyList.appendChild(historyItem);
      });
    }

    // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
    function resetForm() {
      document.getElementById('postText').value = '';
      document.getElementById('photoUrl').value = '';
      document.getElementById('charCount').textContent = '0';
      document.getElementById('scheduleToggle').checked = false;
      document.getElementById('datetimeInput').classList.remove('active');
      document.getElementById('extractedInfo').style.display = 'none';
      document.getElementById('previewImage').style.display = 'none';
      extractedPhotoIds = [];
      localStorage.removeItem('vk_draft');
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
    function showMessage(text, type) {
      const messageEl = type === 'success' ? 
        document.getElementById('successMessage') : 
        document.getElementById('errorMessage');
      
      messageEl.innerHTML = type === 'success' ? 
        `<i class="fas fa-check-circle"></i> ${text}` :
        `<i class="fas fa-exclamation-triangle"></i> ${text}`;
      
      messageEl.style.display = 'block';
      
      const otherMessageEl = type === 'success' ? 
        document.getElementById('errorMessage') : 
        document.getElementById('successMessage');
      otherMessageEl.style.display = 'none';
      
      // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–∞–π—Ç–∞ –µ—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä—É–≥–æ–µ
      document.getElementById('siteMessage').style.display = 'none';
      
      setTimeout(() => {
        messageEl.style.display = 'none';
      }, 5000);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    function updateDebugInfo(message) {
      const debugEl = document.getElementById('debugInfo');
      const timestamp = new Date().toLocaleTimeString();
      debugEl.innerHTML = `<strong>${timestamp}:</strong> ${message}`;
    }

    // –ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏
    document.getElementById('searchHistory').addEventListener('input', function(e) {
      const searchTerm = e.target.value.toLowerCase();
      const historyItems = document.querySelectorAll('.history-item');
      
      historyItems.forEach(item => {
        const text = item.querySelector('.history-text').textContent.toLowerCase();
        if (text.includes(searchTerm)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>
